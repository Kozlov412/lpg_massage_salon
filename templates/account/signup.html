{% extends "account/base.html" %}
{% load i18n %}
{% load static %}
{% load crispy_forms_tags %}

{% block head_title %}{% trans "Signup" %}{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="card border-0 shadow-sm">
        <div class="card-header bg-primary text-white py-3">
          <h1 class="h4 mb-0 text-center">{% trans "Регистрация" %}</h1>
        </div>
        
        <div class="card-body p-4">
          <p class="text-center mb-3">
            {% blocktrans %}Уже есть аккаунт? <a href="{{ login_url }}">Войдите</a>.{% endblocktrans %}
          </p>
          
          <form class="signup" id="signup_form" method="post" action="{% url 'account_signup' %}">
            {% csrf_token %}
            
            <div class="mb-3">
              <label for="id_username" class="form-label">Имя пользователя:</label>
              <input type="text" name="username" placeholder="Имя пользователя" class="form-control" required id="id_username">
              <small class="form-text text-muted">Требуется минимум 3 символа. Только буквы, цифры и символы @/./+/-/_.</small>
            </div>
            
            <div class="mb-3">
              <label for="id_email" class="form-label">Email:</label>
              <input type="email" name="email" placeholder="Email" class="form-control" required id="id_email">
              <small class="form-text text-muted">Email необходим для восстановления пароля и уведомлений</small>
            </div>
            
            <div class="mb-3">
              <label for="id_password1" class="form-label">Пароль:</label>
              <div class="input-group">
                <input type="password" name="password1" placeholder="Пароль" class="form-control" required id="id_password1">
                <button class="btn btn-outline-secondary" type="button" id="password1-toggle">
                  <i class="bi bi-eye-slash"></i>
                </button>
              </div>
              <small class="form-text text-muted">
                <ul class="mb-0 ps-3 mt-1">
                  <li>Минимум 8 символов</li>
                  <li>Не должен состоять только из цифр</li>
                  <li>Не должен быть слишком простым или похожим на ваши личные данные</li>
                </ul>
              </small>
            </div>
            
            <div class="mb-3">
              <label for="id_password2" class="form-label">Подтверждение пароля:</label>
              <div class="input-group">
                <input type="password" name="password2" placeholder="Подтверждение пароля" class="form-control" required id="id_password2">
                <button class="btn btn-outline-secondary" type="button" id="password2-toggle">
                  <i class="bi bi-eye-slash"></i>
                </button>
              </div>
              <small class="form-text text-muted">Повторите пароль для подтверждения</small>
            </div>
            
            {% if redirect_field_value %}
            <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}" />
            {% endif %}
            
            <div class="d-grid gap-2 mt-4">
              <button class="btn btn-primary" type="submit">
                <i class="bi bi-person-plus me-2"></i>{% trans "Зарегистрироваться" %}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Функция для переключения видимости пароля
    function setupPasswordToggle(passwordId, toggleId) {
      const passwordField = document.getElementById(passwordId);
      const passwordToggle = document.getElementById(toggleId);
      
      if (passwordField && passwordToggle) {
        passwordToggle.addEventListener('click', function() {
          const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
          passwordField.setAttribute('type', type);
          
          // Изменяем иконку
          const icon = passwordToggle.querySelector('i');
          if (type === 'password') {
            icon.classList.remove('bi-eye');
            icon.classList.add('bi-eye-slash');
          } else {
            icon.classList.remove('bi-eye-slash');
            icon.classList.add('bi-eye');
          }
        });
      }
    }
    
    // Настраиваем оба поля пароля
    setupPasswordToggle('id_password1', 'password1-toggle');
    setupPasswordToggle('id_password2', 'password2-toggle');
  });
</script>
{% endblock %}
