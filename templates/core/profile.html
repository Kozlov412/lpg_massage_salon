{% extends 'base.html' %}
{% load static %}

{% block title %}Личный кабинет | ЮАнна студия массажа{% endblock %}

{% block content %}
<div class="container py-5">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'home' %}">Главная</a></li>
            <li class="breadcrumb-item active" aria-current="page">Личный кабинет</li>
        </ol>
    </nav>

    <div class="row">
        <!-- Боковое меню -->
        <div class="col-md-3 mb-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex align-items-center mb-4">
                        <div class="flex-shrink-0">
                            <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                                <i class="bi bi-person-fill text-white" style="font-size: 30px;"></i>
                            </div>
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h5 class="mb-0">{{ user.get_full_name }}</h5>
                            <p class="text-muted mb-0 small">{{ user.email }}</p>
                        </div>
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="{% url 'profile' %}" class="list-group-item list-group-item-action active"><i class="bi bi-person-circle me-2"></i>Основная информация</a>
                        <a href="{% url 'appointment_list' %}" class="list-group-item list-group-item-action"><i class="bi bi-calendar-check me-2"></i>Мои записи</a>
                        <a href="{% url 'profile_edit' %}" class="list-group-item list-group-item-action"><i class="bi bi-pencil-square me-2"></i>Редактировать профиль</a>
                        {% if user.is_staff %}
                        <a href="{% url 'admin:index' %}" class="list-group-item list-group-item-action" target="_blank"><i class="bi bi-gear-fill me-2"></i>Админ-панель</a>
                        {% endif %}
                        <a href="{% url 'account_logout' %}" class="list-group-item list-group-item-action text-danger"><i class="bi bi-box-arrow-right me-2"></i>Выйти</a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Основное содержимое -->
        <div class="col-md-9">
            <!-- Информация о профиле -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                    <h5 class="card-title mb-0 brand-font">Информация о профиле</h5>
                    <a href="{% url 'profile_edit' %}" class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-pencil-square me-1"></i>Редактировать
                    </a>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p class="mb-1"><strong>Имя:</strong> {{ user.first_name }}</p>
                            <p class="mb-1"><strong>Фамилия:</strong> {{ user.last_name }}</p>
                            <p class="mb-1"><strong>Email:</strong> {{ user.email }}</p>
                        </div>
                        <div class="col-md-6">
                            <p class="mb-1"><strong>Телефон:</strong> {{ client.phone|default:"Не указан" }}</p>
                            <p class="mb-1"><strong>Дата регистрации:</strong> {{ user.date_joined|date:"d.m.Y" }}</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Последние записи -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                    <h5 class="card-title mb-0 brand-font">Последние записи</h5>
                    <a href="{% url 'appointment_list' %}" class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-list me-1"></i>Все записи
                    </a>
                </div>
                <div class="card-body">
                    {% if appointments %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Услуга</th>
                                        <th>Филиал</th>
                                        <th>Дата и время</th>
                                        <th>Статус</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for appointment in appointments %}
                                    <tr>
                                        <td>{{ appointment.service.name }}</td>
                                        <td>{{ appointment.location.name }}</td>
                                        <td>{{ appointment.date|date:"d.m.Y" }} в {{ appointment.time|time:"H:i" }}</td>
                                        <td>
                                            {% if appointment.status == 'pending' %}
                                                <span class="badge bg-warning text-dark">Ожидает подтверждения</span>
                                            {% elif appointment.status == 'confirmed' %}
                                                <span class="badge bg-success">Подтверждена</span>
                                            {% elif appointment.status == 'completed' %}
                                                <span class="badge bg-info">Завершена</span>
                                            {% elif appointment.status == 'canceled' %}
                                                <span class="badge bg-danger">Отменена</span>
                                            {% endif %}
                                        </td>
                                        <td>
                                            <a href="{% url 'appointment_detail' appointment.id %}" class="btn btn-sm btn-outline-primary">Детали</a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="bi bi-calendar-x text-muted" style="font-size: 3rem;"></i>
                            <p class="mt-3">У вас пока нет записей на процедуры</p>
                            <a href="{% url 'appointment_create' %}" class="btn btn-primary">Записаться на процедуру</a>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Быстрая запись -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-primary text-white py-3">
                    <h5 class="card-title mb-0 brand-font">Быстрая запись на процедуру</h5>
                </div>
                <div class="card-body">
                    <p>Выберите интересующую вас процедуру и запишитесь онлайн:</p>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <a href="{% url 'service_list' 1 %}" class="btn btn-outline-primary d-block py-3">
                                <i class="bi bi-magic me-2"></i>Аппаратный массаж
                            </a>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="{% url 'service_list' 2 %}" class="btn btn-outline-primary d-block py-3">
                                <i class="bi bi-hand-index-thumb me-2"></i>Ручной массаж
                            </a>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="{% url 'service_list' 3 %}" class="btn btn-outline-primary d-block py-3">
                                <i class="bi bi-emoji-smile me-2"></i>Массаж лица
                            </a>
                        </div>
                    </div>
                    <div class="mt-3">
                        <a href="{% url 'appointment_create' %}" class="btn btn-primary">
                            <i class="bi bi-calendar-plus me-2"></i>Создать новую запись
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}